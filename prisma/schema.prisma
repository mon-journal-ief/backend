generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  password              String
  name                  String
  children              Child[]
  refreshToken          String?
  refreshTokenExpiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Gender {
  MALE
  FEMALE
}

enum Grade {
  PS
  MS
  GS
  CP
  CE1
  CE2
  CM1
  CM2
}

model ProgramTemplate {
  id          String           @id @default(uuid())
  name        String
  description String
  grade       Grade
  elements    ProgramElement[]
  programs    Program[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Program {
  id          String           @id @default(uuid())
  name        String
  description String
  grade       Grade
  elements    ProgramElement[]
  children    Child[]

  template   ProgramTemplate? @relation(fields: [templateId], references: [id])
  templateId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProgramElement {
  id          String @id @default(uuid())
  name        String
  description String

  program   Program? @relation(fields: [programId], references: [id])
  programId String?

  template          ProgramTemplate? @relation(fields: [programTemplateId], references: [id])
  programTemplateId String?

  journalEntries JournalEntry[] @relation("ValidatedElements")

  parent   ProgramElement?  @relation("ProgramElementToChildren", fields: [parentId], references: [id])
  children ProgramElement[] @relation("ProgramElementToChildren")
  parentId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Child {
  id             String         @id @default(uuid())
  name           String
  lastName       String?
  profileImage   String?
  age            Int?
  gender         Gender?
  journalEntries JournalEntry[]

  program   Program? @relation(fields: [programId], references: [id])
  programId String?

  user   User   @relation(fields: [userId], references: [id])
  userId String

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model JournalEntry {
  id                String           @id @default(uuid())
  date              DateTime
  comment           String?
  images            String[]
  validatedElements ProgramElement[] @relation("ValidatedElements")

  child   Child  @relation(fields: [childId], references: [id])
  childId String

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}
